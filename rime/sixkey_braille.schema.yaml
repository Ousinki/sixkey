# Rime schema
# encoding: utf-8
#
# SixKey 盲文打字 (Braille to Text)
# 使用 SDF-JKL 并击输入盲文，输出中文
#
# 键位：S=3点 D=2点 F=1点 J=4点 K=5点 L=6点
# 并击 = 同时按下多个键再同时松开
#
# 每个并击产生一个拼音片段（声母或韵母），
# 连续两次并击组成完整拼音音节，进入候选。

schema:
  schema_id: sixkey_braille
  name: "SixKey 盲文打字"
  version: "2.0"
  author:
    - SixKey Project
  description: |
    使用 SDF-JKL 六键并击输入盲文。
    S=3点 D=2点 F=1点 J=4点 K=5点 L=6点
    并击产生拼音，通过拼音输入中文。
    技巧：所有键必须同时按下再同时松开！
  dependencies:
    - luna_pinyin

switches:
  - name: ascii_mode
    reset: 0
    states: [中文, 西文]
  - name: simplification
    reset: 1
    states: [漢字, 汉字]

engine:
  processors:
    - ascii_composer
    - recognizer
    - chord_composer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator
  filters:
    - simplifier
    - uniquifier

chord_composer:
  # 并击按键表，按此顺序排列并击编码
  # 击键虽有先后，形成并击时一律按此顺序排列
  alphabet: "sdfjkl"
  # 将并击编码（排序后的按键组合）转换为拼音的规则
  algebra:
    # ====================================
    # 声母 (Initials) - 按键组合 → 拼音
    # ====================================
    # 排列顺序：按点数从多到少，避免短模式先匹配

    # 全部6键 = ü (dots 123456)
    - "xform/^sdfjkl$/yu/"

    # 5键组合
    - "xform/^sdfjk$/zh/" # dots 12345
    - "xform/^sfjkl$/wu/" # dots 13456 = u (零声母 wu)
    - "xform/^dfjkl$/er/" # dots 12456

    # 4键组合
    - "xform/^sdfj$/sh/" # dots 1234 (sh 优先于 p)
    - "xform/^sdfk$/ch/" # dots 1235 (ch 优先于 r)
    - "xform/^sdjk$/t/" # dots 2345 (t 优先于 ong)
    - "xform/^sfjk$/n/" # dots 1345
    - "xform/^dfjk$/g/" # dots 1245 (g/j 靠韵母区分)
    - "xform/^fjkl$/ian/" # dots 1456
    - "xform/^djkl$/an/" # dots 2456
    - "xform/^sdkl$/ang/" # dots 2356
    - "xform/^sdjl$/ei/" # dots 2346
    - "xform/^sfjl$/iong/" # dots 1346
    - "xform/^sdfl$/ua/" # dots 1236
    - "xform/^sdfkl$/uo/" # dots 12356
    - "xform/^sfkl$/z/" # dots 1356

    # 3键组合
    - "xform/^sdf$/l/" # dots 123
    - "xform/^sfj$/m/" # dots 134
    - "xform/^dfj$/f/" # dots 124
    - "xform/^dfk$/h/" # dots 125 (h/x 靠韵母区分)
    - "xform/^fjk$/d/" # dots 145
    - "xform/^sdj$/s/" # dots 234
    - "xform/^sfk$/o/" # dots 135
    - "xform/^sdk$/ao/" # dots 235
    - "xform/^djl$/ai/" # dots 246
    - "xform/^dfl$/ie/" # dots 126
    - "xform/^fjl$/iao/" # dots 146
    - "xform/^sfl$/iou/" # dots 136
    - "xform/^djk$/ia/" # dots 245
    - "xform/^fkl$/e/" # dots 156
    - "xform/^dkl$/uan/" # dots 256
    - "xform/^dfkl$/uen/" # dots 1256
    - "xform/^dfjl$/ou/" # dots 1246
    - "xform/^sdl$/uei/" # dots 236

    # 2键组合
    - "xform/^df$/b/" # dots 12
    - "xform/^sf$/k/" # dots 13 (k/q 靠韵母区分)
    - "xform/^fj$/c/" # dots 14
    - "xform/^fk$/a/" # dots 15
    - "xform/^dj$/i/" # dots 24 → yi
    - "xform/^dk$/en/" # dots 25
    - "xform/^dl$/uang/" # dots 26
    - "xform/^fl$/in/" # dots 16
    - "xform/^jl$/iao/" # dots 46 (补充)

    # 单键 = 产生空格或无效
    - "xform/^s$//"
    - "xform/^d$//"
    - "xform/^f$//"
    - "xform/^j$//"
    - "xform/^k$//"
    - "xform/^l$//"

  # 并击完成后套用的格式（追加隔音符号）
  output_format:
    - "xform/^([a-z]+)$/$1'/"
  # 并击过程中显示的提示（显示点位符号）
  prompt_format:
    - "xlit|sdfjkl|③②①④⑤⑥|"

editor:
  bindings:
    BackSpace: back_syllable

speller:
  alphabet: "zyxwvutsrqponmlkjihgfedcba'"
  initials: "zyxwvutsrqponmlkjihgfedcba"
  finals: "'"
  delimiter: " "
  algebra:
    - "xform/^([a-z]+)$/$1'/"

translator:
  dictionary: luna_pinyin
  prism: sixkey_braille
  preedit_format:
    - "xform/'/ /"

punctuator:
  import_preset: default

key_binder:
  import_preset: default
  bindings:
    - { when: paging, accept: comma, send: comma }
    - { when: has_menu, accept: period, send: period }

recognizer:
  import_preset: default
